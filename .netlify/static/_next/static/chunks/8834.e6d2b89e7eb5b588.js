"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8834],{49428:(e,r,a)=>{a.d(r,{A:()=>d});var l=a(95155);a(12115);var s=a(47234),t=a(40036);let n=e=>{let r=(0,t.F)({intent:{primary:"bg-blue-100 text-blue-600",secondary:"bg-neutral-200 text-primary",warning:"bg-yellow-100 text-yellow-700",success:"bg-green-100 text-green-700",danger:"bg-red-100 text-red-600"}});return{className:(0,s.p)("w-fit rounded-md px-2 py-1 text-12 font-medium",r("intent.".concat(e)))}},d=e=>{let{children:r,variant:a="primary",className:t=""}=e,{className:d}=n(a);return(0,l.jsx)("div",{className:(0,s.p)(d,t),children:r})}},85194:(e,r,a)=>{a.d(r,{A:()=>p});var l=a(95155),s=a(12115),t=a(47234),n=a(15033),d=a(33703);let o=e=>{let{disabled:r,readOnly:a,valid:l,error:s}=e;return r?"disabled":a?"readOnly":l?"valid":s?"error":"default"};var i=a(40036);let u=(e,r)=>{let{fitContent:a}=r,l=(0,i.F)({default:"border-gray-300 bg-white text-gray-600 focus:border-neutral-800 active:border-neutral-800",disabled:"cursor-not-allowed border-neutral-200 bg-neutral-200 text-neutral-800 focus:border-neutral-200",readOnly:"cursor-default border-neutral-200 bg-neutral-200 text-gray-600 focus:border-neutral-200 active:border-neutral-800",error:"border-red-500 bg-white text-gray-600 focus:border-red-500 active:border-red-500",valid:"border-green-500 bg-white text-gray-600 focus:border-green-500 active:border-green-500"});return{textAreaClassName:(0,t.p)("flex w-full resize-none rounded-sm border px-3 py-[10px] text-14 focus:outline-none focus:ring-0",l(e),{"overflow-hidden":a})}};var c=a(88989);let p=e=>{let{value:r,defaultValue:a,onChange:i,label:p="",disabled:x=!1,readOnly:m=!1,valid:v=!1,error:h="",required:b=!1,showOptionalLabel:g=!1,requiredStyle:f="asterisk",className:y="",fitContent:j=!1,...w}=e,[N,k]=(0,n.A)(r,a),A=(0,s.useRef)(null),{textAreaClassName:C}=u(o({disabled:x,readOnly:m,valid:v,error:h}),{fitContent:j}),F=(0,s.useCallback)(()=>{j&&A.current&&(A.current.style.height="".concat(A.current.scrollHeight,"px"))},[j]),{ref:I}=(0,d.A)(F),S=(0,s.useCallback)(e=>{F(),k(e.target.value),null==i||i(e)},[i,k,F]);return(0,l.jsxs)("div",{children:[(0,l.jsx)(c.A,{required:b,showOptionalLabel:g,requiredStyle:f,children:p}),(0,l.jsx)("textarea",{ref:e=>{A.current=e,I.current=e},className:(0,t.p)(C,y),value:N,readOnly:m,disabled:x,required:b,onChange:S,...w}),h&&(0,l.jsx)("span",{className:"mt-3 block text-12 font-medium text-red-500",children:h})]})}},72879:(e,r,a)=>{a.d(r,{A:()=>t});var l=a(95155),s=a(12115);let t=e=>{let{group:r,label:a,criteria:t,renderRule:n}=e,d=(0,s.useCallback)((e,r)=>{if("rule"===e.type){var a,t,o,i,u,c,p;let s=r.find(r=>r.key===e.key),d=e.key,x=null!==(u=null==s?void 0:s.name)&&void 0!==u?u:d,m=null!==(c=null==s?void 0:null===(t=s.operators)||void 0===t?void 0:null===(a=t.find(r=>r.value===e.operator))||void 0===a?void 0:a.name)&&void 0!==c?c:e.operator,v=null!==(p=null==s?void 0:null===(i=s.values)||void 0===i?void 0:null===(o=i.find(r=>r.value===e.value))||void 0===o?void 0:o.name)&&void 0!==p?p:e.value;return n?n({key:d,name:x,opName:m,valName:v}):(0,l.jsxs)("span",{className:"border border-gray-300 px-2 py-1 text-gray-600",children:[x," ",m," ",v]})}let x=[];for(let a=0;a<e.rules.length;++a){let s="group"===e.rules[a].type&&e.rules[a].rules.length>1&&e.rules[a].combinator!==e.combinator;s&&x.push((0,l.jsx)("span",{className:"text-gray-600",children:"("})),x.push((0,l.jsx)("div",{className:"inline-flex flex-wrap items-center gap-3",children:d(e.rules[a],r)})),s&&x.push((0,l.jsx)("span",{className:"text-gray-600",children:")"})),a<e.rules.length-1&&x.push((0,l.jsx)("span",{children:e.combinator.toLowerCase()}))}return s.Children.toArray(x)},[n]);return(0,l.jsxs)("div",{className:"flex items-start gap-5",children:[a&&(0,l.jsx)("div",{className:"rounded-lg bg-neutral-200 px-6 py-1 font-medium text-gray-700",children:a}),(0,l.jsx)("div",{className:"flex flex-wrap items-center gap-3",children:d(r,t)})]})}},17180:(e,r,a)=>{a.d(r,{A:()=>n});var l=a(12115),s=a(13596),t=a(69402);let n=()=>{var e,r,a;let n=(0,l.useCallback)(()=>s.x.composableCommerce.businessUnit.getAssociateRoles(),[]),d=(0,t.Ay)("/action/buinsess-unit/getAssociateRoles",n);return{...d,data:(null===(e=d.data)||void 0===e?void 0:e.isError)?[]:null!==(a=null===(r=d.data)||void 0===r?void 0:r.data)&&void 0!==a?a:[]}}},52377:(e,r,a)=>{a.r(r),a.d(r,{default:()=>R});var l=a(95155),s=a(12115),t=a(11802),n=a(60798),d=a(91938),o=a(60410),i=a(1547),u=a(72879),c=a(47234),p=a(71918),x=a(66382),m=a(85194),v=a(58617),h=a(73761),b=a(96801),g=a(55195),f=a(13578);let y=e=>{var r;let{approvalFlow:a,userRoles:t,viewOnly:n,approversCriteria:y=[],onApprove:j,onReject:w}=e,{translate:N}=(0,o.A)(),[k,A]=(0,s.useState)(!1),[C,F]=(0,s.useState)(!1),[I,S]=(0,s.useState)(""),R=(0,s.useCallback)((e,r)=>"rule"===r.type?e.key===r.key:r.rules.some(r=>R(e,r)),[]),z=(0,s.useMemo)(()=>{if(!a.rules)return[];let e=a.rules.reduce((e,r)=>{var a,l;return Math.max(e,null!==(l=null===(a=r.approvers)||void 0===a?void 0:a.length)&&void 0!==l?l:0)},0),r=[];for(let s=0;s<e;++s)for(let e of(r.push({type:"group",combinator:"AND",rules:[]}),a.rules)){var l;(null===(l=e.approvers)||void 0===l?void 0:l.length)&&s<e.approvers.length&&r.at(-1).rules.push(e.approvers[s])}return r},[a.rules]),O=z.findIndex(e=>{var r;return(null!==(r=a.currentPendingApproverTiers)&&void 0!==r?r:[]).some(r=>R(r,e))})===z.findIndex(e=>t.filter(e=>!a.approvals.some(r=>!!r.approver.roles.find(r=>r.key===e.key))).some(r=>{var l;return R(r,e)&&(null!==(l=a.eligibleApprovers)&&void 0!==l?l:[]).some(e=>e.key===r.key)})),_=t.every(e=>a.approvals.some(r=>!!r.approver.roles.find(r=>r.key===e.key))),q=(0,s.useCallback)(async()=>{A(!0),await (null==w?void 0:w(I)),F(!1),A(!1),v.A.success(N("dashboard.approval.flow.rejected"),{position:"top-right"})},[w,I,N]);return(0,l.jsxs)("div",{children:[n&&(0,l.jsxs)(d.A,{className:"mt-3",children:[(0,l.jsx)("b",{children:N("common.view.only")})," ",N("dashboard.flow.view.only.desc")]}),(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("h1",{className:"py-6 text-18 font-extrabold text-gray-800 md:py-7 md:text-20 lg:py-9 lg:text-24",children:N("dashboard.flow.details")}),(0,l.jsx)("div",{className:"hidden items-center justify-normal gap-x-3 md:flex",children:(0,l.jsx)(h.A,{})})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,l.jsxs)("h3",{className:"text-14 text-gray-600",children:[N("dashboard.flow.id"),": ",a.id]}),(0,l.jsxs)("h3",{className:"flex items-center gap-2 text-14 text-gray-600",children:[(0,l.jsxs)("span",{children:[N("common.status"),":"]}),(0,l.jsx)(b.A,{status:a.status})]})]}),(0,l.jsxs)("div",{className:"mt-9 border-t border-neutral-400 pt-10",children:[(0,l.jsx)("h5",{className:"pb-9 text-20 font-bold text-gray-700",children:N("common.approval.flow")}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h6",{className:"text-16 font-semibold text-gray-700",children:N("dashboard.rules.applied")}),(0,l.jsx)("div",{className:"mt-4 flex flex-wrap items-center gap-4 rounded-md border border-gray-300 p-6",children:(null!==(r=a.rules)&&void 0!==r?r:[]).map((e,r,a)=>(0,l.jsxs)("div",{children:[(0,l.jsx)(i.default,{href:"".concat(g.s.approvalRules,"?subPath=edit-approval-rule&id=").concat(e.id),className:"text-16 text-blue-700 underline",children:e.name})," ",r<a.length-1&&(0,l.jsx)("span",{children:","})]},e.id))})]})]}),(0,l.jsxs)("div",{className:"mt-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h5",{className:"text-16 font-semibold text-gray-700",children:N("dashboard.approval.flow.required.approvers")}),(0,l.jsx)("div",{className:"mt-1 text-16 font-normal text-gray-700",dangerouslySetInnerHTML:{__html:N("dashboard.approval.flow.required.approvers.desc",{values:{preview:'<div class="w-fit border border-blue-500 p-1 inline-flex items-center gap-1 rounded-sm text-xs text-blue-500">\n                    <span>'.concat(N("common.name"),'</span>\n                    <span class="w-[12px] h-[12px] border border-gray-500 rounded-full block" />\n                  </div>')}})}})]}),(0,l.jsx)("div",{className:"mt-4 rounded-md border border-gray-300 px-7",children:z.map((e,r,s)=>{var n;return(0,l.jsxs)("div",{className:(0,c.p)("py-6",{"border-b border-neutral-400":r<s.length-1}),children:[(0,l.jsxs)("div",{className:"flex items-start gap-5",children:[(0,l.jsx)("div",{className:"shrink-0 rounded-full bg-neutral-200 px-6 py-1 text-16 font-medium text-gray-700",children:"".concat(N("dashboard.tier")," ").concat(r+1)}),(0,l.jsx)(u.A,{group:e,criteria:y,renderRule:e=>{let{key:r,name:s}=e,n=t.some(e=>e.key===r),d=a.approvals.some(e=>!!e.approver.roles.find(e=>e.key===r));return(0,l.jsxs)("div",{className:(0,c.p)("flex w-fit items-center gap-2 rounded-sm border px-2 py-1",{"border-gray-300":!n,"border-blue-500":n}),children:[(0,l.jsx)("span",{className:(0,c.p)({"text-gray-600":!n,"text-blue-500":n}),children:s}),(0,l.jsx)("span",{className:(0,c.p)("flex size-[20px] items-center justify-center rounded-full border-2 p-[3px]",{"border-green-600":d,"border-gray-300":!d}),children:d&&(0,l.jsx)(p.A,{className:"stroke-[5px] text-green-600"})})]})}})]}),(0,l.jsx)("div",{className:"flex flex-wrap items-center pt-6",children:(null!==(n=a.rules)&&void 0!==n?n:[]).map((e,r,a)=>(0,l.jsxs)("div",{className:"whitespace-pre text-gray-500",children:[e.name," ",r<a.length-1&&(0,l.jsxs)("span",{children:[",","  "]})]},e.id))})]},r)})}),(0,l.jsx)("div",{className:"mt-7 flex gap-3",children:C?(0,l.jsxs)("form",{className:"w-full",onSubmit:async e=>{e.preventDefault(),q()},children:[(0,l.jsx)("h6",{className:"mb-3 text-12 font-medium uppercase text-gray-600",children:N("dashboard.approval.flow.rejection.reason")}),(0,l.jsx)(m.A,{value:I,className:"h-[150px] w-full md:h-[65px]",fitContent:!1,error:I.length>160?N("dashboard.message.too.long",{values:{maxCharacters:"160"}}):"",onChange:e=>S(e.target.value)}),(0,l.jsxs)("div",{className:"mt-6 flex gap-3",children:[(0,l.jsx)(x.default,{variant:"secondary",size:"l",onClick:()=>F(!1),children:N("common.cancel")}),(0,l.jsx)(x.default,{type:"submit",size:"l",variant:"primary",loading:k,children:N("common.reject")})]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(x.default,{variant:"secondary",size:"l",className:"leading-[16px]",disabled:n||_||!O||"pending"!==a.status,onClick:()=>{F(!0)},children:N("common.reject")}),(0,l.jsx)(x.default,{variant:"primary",size:"l",className:"py-[12px] leading-[16px]",loading:k,disabled:n||_||!O||"pending"!==a.status,onClick:async()=>{A(!0),await (null==j?void 0:j()),A(!1)},children:N("common.approve")})]})})]}),(0,l.jsx)("div",{className:"mt-10 border-t border-neutral-400",children:(0,l.jsx)(f.A,{order:a.order,showCtaButtons:!1,showOrderStatusBar:!1})})]})};var j=a(37892),w=a(38917),N=a(99184),k=a(66775),A=a(81877),C=a(66493),F=a(36957),I=a(51160),S=a(17180);let R=e=>{var r,a;let{data:s}=e,d=(0,k.A)(),o=null===(r=s.data)||void 0===r?void 0:r.dataSource,{projectSettings:i}=(0,C.A)(),u=(0,I.M)({countries:(null!==(a=null==i?void 0:i.countries)&&void 0!==a?a:[]).map(F.D)}),{selectedBusinessUnit:c}=(0,j.rW)(),{permissions:p}=(0,w.A)(null==c?void 0:c.key),{account:x}=(0,n.A)(),{roles:m}=(0,w.A)(),{data:v}=(0,S.A)(),{approveApprovalFlow:h,rejectApprovalFlow:b}=(0,A.A)({businessUnitKey:null==c?void 0:c.key});return o?(0,l.jsx)(t.A,{userName:null==x?void 0:x.firstName,children:(0,l.jsx)(y,{approvalFlow:(0,N.K1)(o,u),userRoles:m.map(e=>({key:e.key,name:e.name})),viewOnly:!p.UpdateApprovalFlows,approversCriteria:v.map(e=>{let{key:r,name:a}=e;return{key:r,name:null!=a?a:r,type:"text",operators:[],values:[]}}),onApprove:async()=>{let e=await h(o.approvalFlowId);return(null==e?void 0:e.approvalFlowId)&&d.refresh(),!!(null==e?void 0:e.approvalFlowId)},onReject:async e=>{let r=await b(o.approvalFlowId,e);return(null==r?void 0:r.approvalFlowId)&&d.refresh(),!!(null==r?void 0:r.approvalFlowId)}})}):(0,l.jsx)(l.Fragment,{})}}}]);
//# sourceMappingURL=8834.e6d2b89e7eb5b588.js.map