"use strict";exports.id=8902,exports.ids=[8902],exports.modules={10655:(e,a,r)=>{r.d(a,{A:()=>i});var s=r(45512),l=r(58009),t=r(91494),n=r(15535),o=r(85762);let i=({children:e,content:a,icon:r,place:i="right",style:d={},iconWidth:c=20,iconHeight:u=20,className:p="",...m})=>{let v=(0,l.useId)(),h=r??t.A;return(0,s.jsxs)("div",{className:(0,o.p)("flex items-center gap-2",p),children:[e,(0,s.jsx)(h,{width:c,height:u,"data-tooltip-id":v,"data-tooltip-content":a}),(0,s.jsx)(n.m_,{id:v,place:i,style:{zIndex:10,maxWidth:230,...d},...m})]})}},86941:(e,a,r)=>{r.d(a,{A:()=>N});var s=r(45512),l=r(58009),t=r.n(l),n=r(80034),o=r(85762),i=r(54047),d=r(19020);let c=t().createContext({}),u=({children:e,value:{size:a,disabled:r,onChange:t,value:n,className:o,defaultValue:u}})=>{let{isOpen:p,onOpen:m,onClose:v,onToggle:h}=(0,d.A)(),[x,g]=(0,i.A)(n,[]),y=(0,l.useCallback)(e=>{t?.(e),g(e),v()},[t,g,v]);return(0,s.jsx)(c.Provider,{value:{size:a,disabled:r,handleChange:y,value:x,className:o,defaultValue:u,isExpanded:p,onExpand:m,onCollapse:v,onToggle:h},children:e})},p=()=>(0,l.useContext)(c);var m=r(47981),v=r(73475);let h=({children:e})=>{let{handleChange:a,className:r,value:l,disabled:t,defaultValue:n,onCollapse:i}=p(),{ref:d}=(0,v.A)(i);return(0,s.jsx)("div",{ref:d,className:(0,o.p)("relative",r),children:(0,s.jsx)(m.W,{value:l??[],defaultValue:n,onChange:a,disabled:t,multiple:!0,children:e})})};var x=r(31746),g=r(38550);let y=({disabled:e,size:a})=>{let r=(0,g.F)({intent:{active:"cursor-default border-gray-300 bg-white text-gray-700 focus:shadow-200 active:border-neutral-800",disabled:"cursor-not-allowed border-neutral-200 bg-neutral-200 text-neutral-800"},size:{sm:"h-[32px]",lg:"h-[40px]"}});return{buttonClassName:(0,o.p)("relative w-full rounded-md border pl-3 pr-10 text-left text-14 focus:outline-none",r(`intent.${e?"disabled":"active"}`),r(`size.${a}`))}};var j=r(3130),b=r(35971);let f=({children:e,value:a,defaultValue:r,onChange:l,disabled:t,className:n,size:o="lg"})=>(0,s.jsx)(u,{value:{onChange:l,value:a,defaultValue:r,disabled:t,className:n,size:o},children:(0,s.jsx)(h,{children:e})});f.Button=({children:e,className:a})=>{let{translate:r}=(0,n.A)(),{disabled:l,size:t,value:i,defaultValue:d,onToggle:c,isExpanded:u}=p(),{buttonClassName:v}=y({disabled:l,size:t});return(0,s.jsxs)(m.W.Button,{"aria-label":r("common.select"),className:(0,o.p)(a,v),onClick:c,children:[(0,s.jsx)("div",{className:"block truncate",children:"function"==typeof e?e({selected:(i&&0!==i.length?i:d)?.map(e=>({value:e}))??[],isExpanded:u}):e}),(0,s.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3",children:(0,s.jsx)(x.A,{className:"h-[18px]","aria-hidden":"true"})})]})},f.Options=({children:e,className:a})=>{let{isExpanded:r}=p();return(0,s.jsx)(j.e,{show:r,as:l.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,s.jsx)(m.W.Options,{static:!0,className:(0,o.p)("absolute z-50 mt-1 max-h-60 w-full min-w-fit overflow-y-auto rounded-md bg-white py-1 text-base shadow-400 focus:outline-none",a),children:e})})},f.Option=({children:e,value:a})=>{let{value:r,defaultValue:l}=p(),t=!!(a&&(r?.includes(a)||l?.includes(a)));return(0,s.jsx)(m.W.Option,{className:(0,o.p)("relative cursor-default select-none"),value:a,children:(0,s.jsxs)("div",{className:(0,o.p)("flex items-center justify-between gap-5 truncate px-3 py-[10px] text-14 text-gray-700 hover:bg-neutral-200 lg:py-1",{"bg-neutral-200":t}),children:[e,(0,s.jsx)(b.A,{checked:t})]})},a)};var k=r(37897),w=r(26381);let N=({label:e,required:a,requiredStyle:r="asterisk",showOptionalLabel:t=!1,options:i=[],placeholder:d="",enableSearch:c=!1,menuTop:u,...p})=>{let{translate:m}=(0,n.A)(),[v,h]=(0,l.useState)(""),x=(0,l.useMemo)(()=>c&&v?i.filter(({name:e})=>e.toLowerCase().includes(v.toLowerCase())):i,[i,v,c]);return(0,s.jsxs)(f,{...p,children:[(0,s.jsx)(k.A,{required:a,requiredStyle:r,showOptionalLabel:t,children:e}),(0,s.jsx)(f.Button,{children:({selected:e,isExpanded:a})=>c&&a?(0,s.jsx)(w.A,{unStyled:!0,focusOnMount:!0,onClick:e=>e.stopPropagation(),onKeyDown:e=>" "===e.key&&e.stopPropagation(),value:v,onChange:e=>h(e.target.value)}):e?.map(e=>i.find(a=>a.value===e.value)?.name).join(", ")||d}),(0,s.jsxs)(f.Options,{className:(0,o.p)({"bottom-12 shadow-500-reverse":u}),children:[c&&0===x.length&&(0,s.jsx)("p",{className:"px-3 py-2 text-14 text-gray-500",children:m("common.no.results.found")}),x.map(({name:e,value:a})=>(0,s.jsx)(f.Option,{value:a,children:e},a))]})]})}},20897:(e,a,r)=>{r.d(a,{A:()=>d});var s=r(45512),l=r(58009),t=r(688),n=r(25270),o=r(54047),i=r(62408);let d=({children:e,translations:a,onCancel:r,onConfirm:d,isOpen:c,disabled:u=!1,className:p=""})=>{let[m,v]=(0,o.A)(c,!1),h=(0,l.useCallback)(()=>v(!0),[v]),x=(0,l.useCallback)(()=>v(!1),[v]),[g,y]=(0,l.useState)(!1),{blockScroll:j}=(0,n.A)();(0,l.useEffect)(()=>(j(m),()=>j(!1)),[m,j]);let b=(0,l.useCallback)(()=>{r?.(),x()},[r,x]),f=(0,l.useCallback)(async()=>{y(!0),await d?.(),y(!1),x()},[d,x]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:p,onClick:h,children:e}),(0,s.jsxs)(i.A,{className:"lg:max-w-[400px]",isOpen:m,onRequestClose:b,closeButton:!0,children:[(0,s.jsxs)("div",{className:"px-6",children:[(0,s.jsx)("h4",{className:"pb-4 pt-6 text-20 font-semibold text-gray-800",children:a.title}),(0,s.jsx)("p",{className:"text-14 text-gray-700",children:a.summary})]}),(0,s.jsxs)("div",{className:"mt-5 flex items-center justify-end gap-3 border-t border-neutral-400 p-6",children:[(0,s.jsx)(t.default,{variant:"secondary",size:"m",className:"min-w-[112px]",onClick:b,children:a.cancel}),!u&&(0,s.jsx)(t.default,{variant:"warning",size:"m",className:"min-w-[112px]",onClick:f,loading:g,children:a.confirm})]})]})]})}},34285:(e,a,r)=>{r.d(a,{A:()=>n});var s=r(45512),l=r(58009),t=r.n(l);let n=({group:e,label:a,criteria:r,renderRule:n})=>{let o=(0,l.useCallback)((e,a)=>{if("rule"===e.type){let r=a.find(a=>a.key===e.key),l=e.key,t=r?.name??l,o=r?.operators?.find(a=>a.value===e.operator)?.name??e.operator,i=r?.values?.find(a=>a.value===e.value)?.name??e.value;return n?n({key:l,name:t,opName:o,valName:i}):(0,s.jsxs)("span",{className:"border border-gray-300 px-2 py-1 text-gray-600",children:[t," ",o," ",i]})}let r=[];for(let l=0;l<e.rules.length;++l){let t="group"===e.rules[l].type&&e.rules[l].rules.length>1&&e.rules[l].combinator!==e.combinator;t&&r.push((0,s.jsx)("span",{className:"text-gray-600",children:"("})),r.push((0,s.jsx)("div",{className:"inline-flex flex-wrap items-center gap-3",children:o(e.rules[l],a)})),t&&r.push((0,s.jsx)("span",{className:"text-gray-600",children:")"})),l<e.rules.length-1&&r.push((0,s.jsx)("span",{children:e.combinator.toLowerCase()}))}return t().Children.toArray(r)},[n]);return(0,s.jsxs)("div",{className:"flex items-start gap-5",children:[a&&(0,s.jsx)("div",{className:"rounded-lg bg-neutral-200 px-6 py-1 font-medium text-gray-700",children:a}),(0,s.jsx)("div",{className:"flex flex-wrap items-center gap-3",children:o(e,r)})]})}},32950:(e,a,r)=>{r.d(a,{A:()=>n});var s=r(58009),l=r(19217),t=r(77524);let n=()=>{let e=(0,s.useCallback)(()=>l.x.composableCommerce.businessUnit.getAssociateRoles(),[]),a=(0,t.Ay)("/action/buinsess-unit/getAssociateRoles",e);return{...a,data:a.data?.isError?[]:a.data?.data??[]}}},66521:(e,a,r)=>{r.r(a),r.d(a,{default:()=>er});var s=r(45512),l=r(58009),t=r.n(l),n=r(79334),o=r(62621),i=r(93001),d=r(1916),c=r(80034),u=r(16857),p=r(688),m=r(28165),v=r(25306),h=r(92321),x=r(96848),g=r(94796),y=r(37974);let j=l.forwardRef(function({title:e,titleId:a,...r},s){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":a},r),e?l.createElement("title",{id:a},e):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"}))});var b=r(15535),f=r(29559),k=r(85762);let w=({approvalRules:e,onDuplicate:a,pagination:r,viewOnly:t})=>{let{translate:n}=(0,c.A)(),[o,i]=(0,l.useState)({}),d=(0,l.useCallback)(async(e,r)=>{i({...o,[r]:!0}),await a?.(e),i({...o,[r]:!1})},[a,o]);return(0,s.jsxs)(x.A,{children:[(0,s.jsxs)(x.A.Container,{className:"table",children:[(0,s.jsx)(x.A.Head,{children:(0,s.jsxs)(x.A.Row,{children:[(0,s.jsx)(x.A.Cell,{isHeadCell:!0,children:n("common.name")}),(0,s.jsx)(x.A.Cell,{isHeadCell:!0,children:n("common.requesters")}),(0,s.jsx)(x.A.Cell,{isHeadCell:!0,children:n("common.status")}),(0,s.jsx)(x.A.Cell,{isButtonsHead:!0})]})}),(0,s.jsx)(x.A.Body,{children:e.map((e,a)=>(0,s.jsxs)(x.A.Row,{children:[(0,s.jsx)(x.A.Cell,{children:(0,s.jsx)("div",{className:"max-w-[40vw] truncate",children:e.name})}),(0,s.jsx)(x.A.Cell,{children:e.requesters.map(e=>e.name??e.key??"").join(", ")}),(0,s.jsx)(x.A.Cell,{children:(0,s.jsx)(g.A,{variant:"active"===e.status?"success":"danger",children:n(`common.status.${e.status}`)})}),(0,s.jsx)(x.A.Cell,{children:(0,s.jsxs)("div",{className:"flex items-center justify-end gap-5 text-primary",children:[(0,s.jsxs)(m.default,{"aria-label":n("dashboard.edit.approval.rule"),href:t?"#":`?subPath=edit-approval-rule&id=${e.id}`,children:[(0,s.jsx)(y.A,{className:(0,k.p)({"cursor-not-allowed opacity-30":t,"cursor-pointer":!t}),width:20,"data-tooltip-id":`${e.id}-edit-tooltip`,"data-tooltip-content":n("dashboard.edit.approval.rule")}),(0,s.jsx)(b.m_,{id:`${e.id}-edit-tooltip`,place:"top"})]}),(0,s.jsx)("div",{className:"hidden",children:o[a]?(0,s.jsx)(f.A,{svgWidth:20,svgHeight:20,className:"fill-primary"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(j,{className:"cursor-pointer",width:20,onClick:()=>d(e,a),"data-tooltip-id":`${e.id}-duplicate-tooltip`,"data-tooltip-content":n("dashboard.duplicate.approval.rule")}),(0,s.jsx)(b.m_,{id:`${e.id}-duplicate-tooltip`,place:"top"})]})})]})})]},e.id))})]}),r&&(0,s.jsx)(x.A.Pagination,{...r})]})},N=({viewOnly:e,initialBusinessUnit:a,onBusinessUnitChange:r,businessUnitOptions:l,approvalRules:t,loading:n,pagination:o,onDuplicate:i})=>{let{translate:d}=(0,c.A)();return(0,s.jsxs)("div",{children:[e&&(0,s.jsxs)(v.A,{className:"mt-3",children:[(0,s.jsx)("b",{children:d("common.view.only")})," ",d("dashboard.rule.view.only.desc")]}),(0,s.jsx)("h1",{className:"py-6 text-18 font-extrabold text-gray-800 md:py-7 md:text-20 lg:py-9 lg:text-24",children:d("common.approval.rules")}),(0,s.jsxs)("div",{className:"flex items-end justify-between gap-3",children:[(0,s.jsx)(u.A,{className:"w-[280px]",label:d("common.business.unit"),placeholder:d("common.select"),enableSearch:!0,options:l,defaultValue:a,onChange:r}),(0,s.jsx)(m.default,{href:e?"#":"?subPath=add-approval-rule",className:"block w-full md:w-fit",underlineOnHover:!1,children:(0,s.jsx)(p.default,{size:"m",className:"w-full px-6",disabled:e,children:d("dashboard.approval.rule.add")})})]}),(0,s.jsx)("div",{className:"mt-8",children:t.length>0?(0,s.jsx)(w,{approvalRules:t,onDuplicate:i,pagination:o,viewOnly:e}):(0,s.jsx)(h.A,{isLoading:n,header:d("common.no.results.found")})})]})};var A=r(77524),C=r(19217);let R=({businessUnitKey:e,storeKey:a,filters:{cursor:r,limit:s}={}})=>{let{data:t,mutate:n,...o}=(0,A.Ay)(e?["/action/business-unit/queryApprovalRules",e,r,s]:null,()=>C.x.composableCommerce.businessUnit.queryApprovalRules({businessUnitKey:e,approvalRuleIds:[],approvalRuleStatus:[],cursor:r,limit:s,sortAttributes:[{createdAt:"desc"}]})),i=!e||o.isLoading,d=t?.isError?[]:t?.data?.items??[],c=t?.isError?0:t?.data.total??0,[u,p]=t?.isError?[void 0,void 0]:[t?.data.previousCursor,t?.data.nextCursor];return{approvalRules:d,isLoading:i,totalItems:c,previousCursor:u,nextCursor:p,createApprovalRule:(0,l.useCallback)(async r=>{if(!e||!a)return;let s=await C.x.composableCommerce.businessUnit.createApprovalRule({approvalRule:r},{businessUnitKey:e,storeKey:a});return s.isError||n(),s.isError?void 0:s.data},[e,a,n]),updateApprovalRule:(0,l.useCallback)(async(r,s)=>{if(!e||!a)return;let l=await C.x.composableCommerce.businessUnit.updateApprovalRule({approvalRule:{approvalRuleId:r,...s}},{businessUnitKey:e});return l.isError||n(),l.isError?void 0:l.data},[e,a,n])}};var P=r(34878),L=r(32950),O=r(62999),S=r(6505),$=r(33211),U=r(42117),E=r(72190),q=r(65593);let M=()=>{let{businessUnits:e}=(0,E.A)(),{selectedBusinessUnit:a}=(0,q.rW)(),[r,s]=(0,l.useState)(),t=(0,l.useCallback)(e=>{s(e)},[]),n=e?.find(e=>e.key===r)??e.find(e=>e.key===a?.key)??e[0];return{businessUnits:e??[],activeBusinessUnit:n,onBusinessUnitSelected:t}};var H=r(26381),F=r(10655),B=r(86941),D=r(54047);let z=({label:e,checked:a,defaultChecked:r=!1,onChange:t})=>{let[n,o]=(0,D.A)(a,r),i=(0,l.useCallback)(e=>{o(e),t?.(e)},[o,t]);return(0,s.jsxs)("label",{className:"inline-flex cursor-pointer select-none items-center gap-3",children:[e&&(0,s.jsx)("div",{className:"font-medium text-gray-700",children:e}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"checkbox",checked:n,onChange:e=>i(e.target.checked),className:"sr-only"}),(0,s.jsx)("div",{className:(0,k.p)("block h-8 w-14 rounded-full border border-neutral-400",n?"bg-secondary":"bg-white")}),(0,s.jsxs)("div",{className:(0,k.p)("absolute left-1 top-1 flex size-6 items-center justify-center rounded-full bg-neutral-100 transition",{"translate-x-full":n}),children:[(0,s.jsx)("span",{className:n?"block":"hidden",children:(0,s.jsx)("svg",{className:"stroke-secondary",width:"11",height:"8",viewBox:"0 0 11 8",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{d:"M10.0915 0.951972L10.0867 0.946075L10.0813 0.940568C9.90076 0.753564 9.61034 0.753146 9.42927 0.939309L4.16201 6.22962L1.58507 3.63469C1.40401 3.44841 1.11351 3.44879 0.932892 3.63584C0.755703 3.81933 0.755703 4.10875 0.932892 4.29224L0.932878 4.29225L0.934851 4.29424L3.58046 6.95832C3.73676 7.11955 3.94983 7.2 4.1473 7.2C4.36196 7.2 4.55963 7.11773 4.71406 6.9584L10.0468 1.60234C10.2436 1.4199 10.2421 1.1339 10.0915 0.951972ZM4.2327 6.30081L4.2317 6.2998C4.23206 6.30015 4.23237 6.30049 4.23269 6.30082L4.2327 6.30081Z",strokeWidth:"1"})})}),(0,s.jsx)("span",{className:n?"hidden":"block",children:(0,s.jsx)("svg",{className:"size-4 stroke-secondary",fill:"none",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})]})]})};var I=r(20897),W=r(28390),G=r(48208);let _=({criteria:e,className:a,value:r,disabled:l,onChange:t})=>e?e.type&&"text"!==e.type?(0,s.jsx)(u.A,{options:e.values??[],value:r,className:a,disabled:l,onChange:t}):(0,s.jsx)(H.A,{value:r,onChange:e=>t?.(e.target.value),disabled:l,outerContainerClassName:a}):(0,s.jsx)(s.Fragment,{}),T=({rule:e,singleMode:a,criteria:r,addButtonIsDisabled:l,onUpdate:t,onRemove:n,onAddNew:o})=>{let{translate:i}=(0,c.A)(),d=r.find(a=>a.key===e.key);return(0,s.jsxs)("div",{className:"grid grid-cols-12 gap-3",children:[(0,s.jsx)(u.A,{options:r.map(({key:e,name:a})=>({name:a,value:e})),value:e.key,className:"col-span-4",placeholder:i("common.select.predicate"),onChange:a=>t({...e,key:a,operator:"",value:""})}),!a&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.A,{options:d?.operators??[],value:e.operator,className:"col-span-2",disabled:!e.key,onChange:a=>t({...e,operator:a})}),(0,s.jsx)(_,{criteria:d,value:e.value,className:"col-span-4",disabled:!e.key,onChange:a=>t({...e,value:a})})]}),(0,s.jsxs)("div",{className:(0,k.p)("flex gap-2",a?"col-span-8":"col-span-2"),children:[(0,s.jsx)(p.default,{variant:"secondary",size:"l",Icon:W.A,onClick:n}),(0,s.jsx)(p.default,{size:"l",Icon:G.A,disabled:!a&&(!e.key||!e.operator||!e.value)||a&&!e.key||l,onClick:o})]})]})},V=({rule:e,singleMode:a,translations:r,criteria:l,onUpdate:t,onRemove:n})=>{let{translate:o}=(0,c.A)(),i=l.find(a=>a.key===e.key),d=!a&&(!e.key||!e.operator||!e.value)||a&&!e.key;return(0,s.jsxs)("div",{className:"grid grid-cols-12 gap-3",children:[(0,s.jsx)(u.A,{options:l.map(({key:e,name:a})=>({name:a,value:e})),value:e.key,className:"col-span-3",placeholder:o("common.select.predicate"),onChange:a=>t({...e,key:a,operator:"",value:""})}),!a&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.A,{options:i?.operators??[],value:e.operator,className:"col-span-2",disabled:!e.key,onChange:a=>t({...e,operator:a})}),(0,s.jsx)(_,{criteria:i,value:e.value,className:"col-span-3",disabled:!e.key,onChange:a=>t({...e,value:a})})]}),(0,s.jsxs)("div",{className:(0,k.p)("flex gap-2",a?"col-span-9":"col-span-4"),children:[(0,s.jsx)(p.default,{variant:"secondary",size:"l",Icon:W.A,onClick:n}),(0,s.jsx)(p.default,{variant:"secondary",disabled:d,onClick:()=>t({...e,isPlaceholder:!1}),children:r?.addRule??o("dashboard.add.rule")}),(0,s.jsx)(p.default,{variant:"secondary",disabled:d,onClick:()=>t({type:"group",combinator:"AND",rules:[{...e,isPlaceholder:!1}]}),children:r?.addSubgroup??o("dashboard.add.subgroup")})]})]})},K=({group:e,singleMode:a,translations:r,includeGroupHeader:n,includeRemoveButton:o,onRemoveGroup:i,criteria:d,onUpdate:u,onRemove:p})=>{let{translate:m}=(0,c.A)(),v=(0,l.useCallback)((l,t)=>{let n=a=>u({...e,rules:[...e.rules.slice(0,t),a,...e.rules.slice(t+1)]}),o=()=>1===e.rules.length?p():u({...e,rules:[...e.rules.slice(0,t),...e.rules.slice(t+1)]});switch(l.type){case"group":return(0,s.jsx)(K,{group:l,translations:r,singleMode:a,criteria:d,onUpdate:n,onRemove:o});case"rule":if(l.isPlaceholder)return(0,s.jsx)(V,{rule:l,translations:r,singleMode:a,criteria:d,onUpdate:n,onRemove:o});return(0,s.jsx)(T,{rule:l,singleMode:a,criteria:d,addButtonIsDisabled:t<e.rules.length-1,onUpdate:n,onRemove:o,onAddNew:()=>u({...e,rules:[...e.rules,{type:"rule",isPlaceholder:!0,key:"",operator:"",value:""}]})})}},[d,e,u,p,a,r]);return(0,s.jsxs)("div",{className:"rounded-lg border border-gray-300 p-6",children:[n&&(0,s.jsxs)("div",{className:"flex items-center justify-between pb-6",children:[(0,s.jsx)("span",{className:"font-medium text-gray-700",children:r?.groupHeaderLabel??""}),o&&(0,s.jsxs)("div",{className:"flex w-fit cursor-pointer items-center gap-2 text-14 text-gray-600",onClick:i,children:[(0,s.jsx)("span",{children:m("common.remove")}),(0,s.jsx)(W.A,{width:24,height:24})]})]}),(0,s.jsx)("div",{className:"grid w-[100px] grid-cols-2 gap-px",children:[{key:"AND"},{key:"OR"}].map((a,r,l)=>(0,s.jsx)("div",{className:(0,k.p)("cursor-pointer py-3 text-center text-14 font-medium outline outline-1",{"bg-primary text-white outline-primary":a.key===e.combinator,"bg-white text-gray-500 outline-gray-300 transition hover:bg-gray-50":a.key!==e.combinator,"rounded-l-md":0===r,"rounded-r-md":r===l.length-1}),onClick:()=>u({...e,combinator:a.key}),children:a.key},a.key))}),(0,s.jsx)("div",{className:"mt-4 flex flex-col items-stretch gap-4",children:t().Children.toArray(e.rules.map((a,r,l)=>(0,s.jsxs)(s.Fragment,{children:[v(a,r),r<l.length-1&&(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("span",{className:"block shrink-0 text-14 font-medium text-gray-600",children:e.combinator}),(0,s.jsx)("div",{className:"h-px flex-1 bg-neutral-400"})]})]})))})]})};var Z=r(34285);let J=({group:e,singleMode:a,translations:r,includeGroupHeader:t,includeRemoveButton:n,onRemoveGroup:o,criteria:i,isPreview:d,onRuleUpdate:c,onReset:u})=>{let p=(0,l.useMemo)(()=>({type:"group",combinator:"AND",rules:[{type:"rule",isPlaceholder:!0,key:"",operator:"",value:""}]}),[]),[m,v]=(0,D.A)(e,p),h=(0,l.useCallback)(e=>{v(e),c?.(e)},[c,v]),x=(0,l.useCallback)(()=>{v(p),u?.()},[p,u,v]);return d?(0,s.jsx)(Z.A,{group:m,criteria:i,label:t?r?.groupHeaderLabel:""}):(0,s.jsx)(K,{group:m,translations:r,includeGroupHeader:t,includeRemoveButton:n,onRemoveGroup:o,singleMode:a,criteria:i,onUpdate:h,onRemove:x})},Q=({title:e,summary:a,error:r,addRule:l,onAddRule:n,isPreviewing:o,onPreviewStart:i,onPreviewEnd:d,onRuleUpdate:u,criteria:m,tiers:v=[],maxTiers:h,onTierAdd:x,onTierRemove:g,allowMultiTier:y=!1,singleMode:j=!1,translations:b={},includeGroupHeader:f=!1})=>{let{translate:w}=(0,c.A)();return(0,s.jsxs)("div",{children:[(0,s.jsx)("h5",{className:"text-18 font-medium text-gray-700",children:e}),(0,s.jsx)("p",{className:"mt-2 text-gray-600",children:a}),r&&(0,s.jsx)("p",{className:"py-3 text-red-500",children:r}),(0,s.jsx)("div",{className:"mt-6 flex flex-col",children:l?(0,s.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,s.jsxs)("div",{className:(0,k.p)({"relative min-h-[100px] rounded-md border border-gray-300 p-6 pr-32":o}),children:[(0,s.jsx)("div",{className:(0,k.p)("flex flex-col",{"gap-3":!o}),children:t().Children.toArray(v.map((e,a,r)=>(0,s.jsx)("div",{className:(0,k.p)({"border-b border-gray-300 pb-6":o&&v.length>1&&a<r.length-1,"pt-6":o&&v.length>1&&a>0}),children:(0,s.jsx)(J,{group:e,translations:{...b,groupHeaderLabel:`${w("dashboard.tier")} ${a+1}`},includeGroupHeader:f,includeRemoveButton:r.length>1,onRemoveGroup:()=>g?.(a),singleMode:j,isPreview:o,criteria:m,onRuleUpdate:e=>u(e,a)})})))}),o&&(0,s.jsx)("div",{className:"absolute right-6 top-6",children:(0,s.jsx)(p.default,{variant:"secondary",onClick:()=>d(),children:w("common.edit")})})]}),y&&!o&&(void 0===h||v.length<h)&&(0,s.jsx)(p.default,{variant:"secondary",className:"self-end",size:"m",onClick:x,children:w("dashboard.add.approval.tier")}),!o&&(0,s.jsx)(p.default,{className:"w-fit min-w-[140px]",size:"m",onClick:()=>i(),children:w("common.preview")})]}):(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("div",{className:"h-[40px] grow rounded-md border border-gray-300"}),(0,s.jsx)(p.default,{className:"min-w-[100px]",onClick:n,children:w("common.add")})]})})]})},X=({approvalRules:e,viewOnly:a,roles:r,rulesCriteria:t,approversCriteria:o,onSubmit:i})=>{let{translate:d}=(0,c.A)(),u=(0,O.A)(),m=(0,n.useSearchParams)().get("id"),h=e.find(e=>e.id===m),[x,g]=(0,l.useState)(h??{status:"active",requesters:[],approvers:[{type:"group",combinator:"AND",rules:[{type:"rule",isPlaceholder:!0,key:"",operator:"",value:""}]}],rules:[{type:"group",combinator:"AND",rules:[{type:"rule",isPlaceholder:!0,key:"",operator:"",value:""}]}]}),[y,j]=(0,l.useState)({rules:!!h,approvers:!!h}),[b,f]=(0,l.useState)({rules:!!h,approvers:!!h});(0,l.useEffect)(()=>{h&&(g(h),j({rules:!!h,approvers:!!h}),f({rules:!!h,approvers:!!h}))},[h]);let k=e=>{if(!e?.rules?.length)return!1;for(let a of e.rules)if("rule"===a.type){if(a.isPlaceholder)return!1}else if(!k(a))return!1;return!0},w=!x.name||!x.requesters?.length||!x.rules?.every(k)||!x.approvers?.every(k),[N,A]=(0,l.useState)(!1),C=(0,l.useCallback)(async()=>{A(!0),await i(x),A(!1)},[x,i]);return(0,s.jsxs)("div",{className:"pb-12",children:[a&&(0,s.jsxs)(v.A,{className:"mt-3",children:[(0,s.jsx)("b",{children:d("common.view.only")})," ",d("dashboard.rule.view.only.desc")]}),(0,s.jsx)("h1",{className:"py-6 text-18 font-extrabold text-gray-800 md:py-7 md:text-20 lg:py-9 lg:text-24",children:d(m?"dashboard.approval.rule.edit":"dashboard.approval.rule.add")}),(0,s.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,s.jsx)(H.A,{name:"name",label:d("dashboard.rule.name"),required:!0,containerClassName:"max-w-[400px]",value:x.name??"",onChange:e=>g({...x,name:e.target.value})}),(0,s.jsx)(H.A,{name:"description",label:d("common.description"),showOptionalLabel:!0,containerClassName:"max-w-[400px]",value:x.description??"",onChange:e=>g({...x,description:e.target.value})}),(0,s.jsx)(B.A,{label:(0,s.jsx)(F.A,{content:d("dashboard.role.requesters.desc"),children:d("dashboard.role.requesters")}),options:r,className:"w-full max-w-[400px]",value:x.requesters.map(e=>e.key),onChange:e=>g({...x,requesters:r.filter(a=>e.includes(a.value)).map(({name:e,value:a})=>({key:a,name:e}))})})]}),(0,s.jsx)("div",{className:"mt-12",children:(0,s.jsx)(Q,{title:`${d("common.rule")} *`,summary:`${d("common.rule.desc")}`,error:b.rules&&!x.rules?.every(k)?d("dashboard.rules.setup.incomplete"):"",criteria:t,tiers:x.rules,addRule:y.rules,onAddRule:()=>j({...y,rules:!0}),isPreviewing:b.rules,onPreviewStart:()=>f({...b,rules:!0}),onPreviewEnd:()=>f({...b,rules:!1}),onRuleUpdate:(e,a)=>g({...x,rules:[...x.rules.slice(0,a),e,...x.rules.slice(a+1)]})})}),(0,s.jsx)("div",{className:"mt-12",children:(0,s.jsx)(Q,{title:`${d("common.approvers")} *`,summary:`${d("common.approvers.desc")}`,translations:{addRule:d("dashboard.add.approver"),addSubgroup:d("dashboard.add.approval.group")},error:b.approvers&&!x.approvers?.every(k)?d("dashboard.tiers.setup.incomplete"):"",criteria:o,includeGroupHeader:!0,singleMode:!0,tiers:x.approvers,maxTiers:5,allowMultiTier:!0,onTierAdd:()=>g({...x,approvers:[...x.approvers,{type:"group",combinator:"AND",rules:[{type:"rule",isPlaceholder:!0,key:"",operator:"",value:""}]}]}),onTierRemove:e=>g({...x,approvers:[...x.approvers.slice(0,e),...x.approvers.slice(e+1)]}),addRule:y.approvers,onAddRule:()=>j({...y,approvers:!0}),isPreviewing:b.approvers,onPreviewStart:()=>f({...b,approvers:!0}),onPreviewEnd:()=>f({...b,approvers:!1}),onRuleUpdate:(e,a)=>g({...x,approvers:[...(x.approvers??[]).slice(0,a),e,...(x.approvers??[]).slice(a+1)]})})}),(0,s.jsx)("div",{className:"mt-12",children:(0,s.jsx)(z,{label:d("dashboard.set.rule.as.active"),defaultChecked:"active"===x.status,onChange:e=>g({...x,status:e?"active":"inactive"})})}),(0,s.jsxs)("div",{className:"mt-12 flex w-full max-w-[412px] gap-3",children:[(0,s.jsx)(I.A,{className:"flex-1",onConfirm:async()=>u.back(),translations:{title:d("common.unsaved.changes"),summary:d("common.unsaved.changes.warning"),cancel:d("common.cancel"),confirm:d("common.leave")},children:(0,s.jsx)(p.default,{className:"w-full",variant:"secondary",children:d("common.cancel")})}),(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)(p.default,{className:"w-full",variant:"primary",disabled:w||a,onClick:C,loading:N,children:d("common.save")})})]})]})},Y=e=>{let a=(0,n.useSearchParams)().get("subPath"),r=(0,l.useMemo)(()=>{let r={"add-approval-rule":{title:"",Component:(0,s.jsx)(X,{...e})},"edit-approval-rule":{title:"",Component:(0,s.jsx)(X,{...e})}};if(a&&Object.keys(r).includes(a))return r[a]},[a,e]);return{subPath:a,ActiveSubPath:r}},ee=()=>{let[e,a]=(0,l.useState)(25),[r,s]=(0,l.useState)("offset:0"),t=Math.floor(+r.split(":")[1]/e)+1;return{limit:e,page:t,setLimit:a,cursor:r,setCursor:s}};var ea=r(86630);let er=()=>{let{translate:e}=(0,c.A)(),a=(0,O.A)(),r=(0,n.useSearchParams)().get("id"),{projectSettings:l}=(0,$.A)(),t=(0,ea.M)({countries:(l?.countries??[]).map(U.D)}),{activeBusinessUnit:u,onBusinessUnitSelected:p,businessUnits:m}=M(),{account:v}=(0,d.A)(),{page:h,limit:x,setLimit:g,cursor:y,setCursor:j}=ee(),{approvalRules:b,isLoading:f,totalItems:k,previousCursor:w,nextCursor:A,createApprovalRule:C,updateApprovalRule:E}=R({businessUnitKey:u?.key,storeKey:u.stores?.[0].key,filters:{cursor:y,limit:x}}),{data:q}=(0,L.A)(),{permissions:H}=(0,S.A)(u.key),F={viewOnly:!(H.CreateApprovalRules&&H.UpdateApprovalRules),businessUnitOptions:m.map(({name:e,key:a})=>({name:e??a??"",value:a??""})),initialBusinessUnit:u?.key,onBusinessUnitChange:p,approvalRules:b.map(e=>(0,P.Ah)(e,t)),loading:f,roles:q.map(e=>({name:e.name,value:e.key})),rulesCriteria:Object.entries(t).map(([a,r])=>({key:a,type:r.type,name:e(r.name),operators:r.operators.map(a=>({name:e(a.name),value:a.value})),values:(r.values??[]).map(a=>({name:e(a.name),value:a.value}))})),approversCriteria:q.filter(e=>e.permissions?.includes("UpdateApprovalFlows")).map(({key:e,name:a})=>({key:e,name:a??e,type:"text",operators:[],values:[]})),pagination:{page:h,totalItems:k,limit:x,onPrevious(){w&&j(w)},onNext(){A&&j(A)},onRowsPerPageChange(e){g(+e)}},async onDuplicate(e){let a=(0,P.GO)(e,t),r=await C(a);return!!r?.approvalRuleId},async onSubmit(e){let s=(0,P.GO)(e,t),l=await (r?E(r,s):C(s)),n=!!l?.approvalRuleId;return n&&a.back(),n}},{ActiveSubPath:B}=Y(F);return(0,s.jsx)(o.A,{title:B?.title,href:i.s.approvalRules,userName:v?.firstName,children:B?.Component??(0,s.jsx)(N,{...F})})}},86630:(e,a,r)=>{r.d(a,{M:()=>s});let s=({countries:e})=>({"totalPrice.centAmount":{type:"text",name:"cart.cart.amount",operators:[{name:"common.is.equal",value:"="},{name:"common.is.more.than",value:">"},{name:"common.is.more.than.or.equal",value:">="},{name:"common.is.less.than",value:"<"},{name:"common.is.less.than.or.equal",value:"<="}],constructPredicateFromRule:e=>`${e.key} ${e.operator} ${100*parseInt(e.value)}`,constructRuleFromPredicate(e){let[a,r,s]=e.split(" ");return{key:a,operator:r,value:Math.floor(parseInt(s)/100).toString()}}},currency:{type:"enum",name:"common.currency",operators:[{name:"common.is",value:"is"},{name:"common.is.not",value:"is_not"}],values:[{name:"USD",value:"USD"},{name:"EUR",value:"EUR"}],constructPredicateFromRule:e=>`${e.key} ${"is"===e.operator?"=":"!="} "${e.value}"`,constructRuleFromPredicate(e){let[a,r,s]=e.split(" ");return{key:a,operator:"="===r?"is":"is_not",value:s}}},country:{type:"enum",name:"common.country",operators:[{name:"common.is",value:"is"},{name:"common.is.not",value:"is_not"}],values:e.map(({name:e,code:a})=>({name:e,value:a})),constructPredicateFromRule:e=>`${e.key} ${"is"===e.operator?"=":"!="} "${e.value}"`,constructRuleFromPredicate(e){let[a,r,s]=e.split(" ");return{key:a,operator:"="===r?"is":"is_not",value:s}}}})},34878:(e,a,r)=>{r.d(a,{Ah:()=>i,GO:()=>t});let s=e=>{if(!e)return[];let a=e=>"rule"===e.type?{or:[{key:e.key}]}:{or:e.rules.filter(e=>"rule"===e.type).map(e=>({key:e.key}))};return e.map(e=>e.rules.map(a)).map(e=>({and:e}))},l=(e,a)=>{if(!e)return"";let r=e=>{if("rule"===e.type)return a[e.key].constructPredicateFromRule(e);let s=[];for(let a=0;a<e.rules.length;++a){let l="group"===e.rules[a].type&&e.rules[a].rules.length>1&&e.rules[a].combinator!==e.combinator;l&&s.push("("),s.push(r(e.rules[a])),l&&s.push(")"),a<e.rules.length-1&&s.push(e.combinator.toLowerCase())}return s.join(" ")};return r(e[0])},t=(e,a)=>({name:e.name,description:e.description,requesters:e.requesters,approvalRuleStatus:"active"===e.status?"Active":"Inactive",approvers:{tiers:s(e.approvers)},predicate:l(e.rules,a)}),n=(e,a)=>{let r=e=>{let s=[],l=e.split(" "),t="AND",n=[],o=()=>{let[e,r,l]=[n.pop(),n.pop(),n.pop()];s.push({type:"rule",...a[l].constructRuleFromPredicate(`${l} ${r} ${e.replace(/\"/g,"")}`)})},i=0;for(;i<l.length;){let e=i+1;if("("===l[i]){let a=[],t=0;for(;")"!==l[e]||t>0;)"("===l[e]?++t:")"===l[e]&&--t,a.push(l[e++]);++e,s.push(r(a.join(" ")))}else"and"===l[i]||"or"===l[i]?(t="and"===l[i]?"AND":"OR",o()):n.push(l[i]);i=e}return n.length>0&&o(),{type:"group",combinator:t,rules:s}};return[r(e)]},o=e=>e.tiers.map(e=>e.and).map(e=>({type:"group",combinator:"AND",rules:e.map(e=>{let a=e=>({type:"rule",isPlaceholder:!1,key:e.key,operator:"",value:""});return 1===e.or.length?a(e.or[0]):{type:"group",combinator:"OR",rules:e.or.map(e=>a(e))}})})),i=(e,a)=>({id:e.approvalRuleId??e.key??"",name:e.name,description:e.description,requesters:e.requesters.map(({key:e,name:a})=>({key:e??"",name:a??e??""})),status:(e.approvalRuleStatus??"Inactive").toLowerCase(),rules:n(e.predicate,a),approvers:o(e.approvers)})},37974:(e,a,r)=>{r.d(a,{A:()=>l});var s=r(58009);let l=s.forwardRef(function({title:e,titleId:a,...r},l){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":a},r),e?s.createElement("title",{id:a},e):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"}))})},28390:(e,a,r)=>{r.d(a,{A:()=>l});var s=r(58009);let l=s.forwardRef(function({title:e,titleId:a,...r},l){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":a},r),e?s.createElement("title",{id:a},e):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))})}};