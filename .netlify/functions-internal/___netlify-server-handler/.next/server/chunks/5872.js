"use strict";exports.id=5872,exports.ids=[5872],exports.modules={94796:(e,r,a)=>{a.d(r,{A:()=>n});var t=a(45512);a(58009);var s=a(85762),l=a(38550);let o=e=>{let r=(0,l.F)({intent:{primary:"bg-blue-100 text-blue-600",secondary:"bg-neutral-200 text-primary",warning:"bg-yellow-100 text-yellow-700",success:"bg-green-100 text-green-700",danger:"bg-red-100 text-red-600"}});return{className:(0,s.p)("w-fit rounded-md px-2 py-1 text-12 font-medium",r(`intent.${e}`))}},n=({children:e,variant:r="primary",className:a=""})=>{let{className:l}=o(r);return(0,t.jsx)("div",{className:(0,s.p)(l,a),children:e})}},3486:(e,r,a)=>{a.d(r,{A:()=>c});var t=a(45512),s=a(58009),l=a(85762),o=a(54047),n=a(20231);let i=({disabled:e,readOnly:r,valid:a,error:t})=>e?"disabled":r?"readOnly":a?"valid":t?"error":"default";var p=a(38550);let d=(e,{fitContent:r})=>{let a=(0,p.F)({default:"border-gray-300 bg-white text-gray-600 focus:border-neutral-800 active:border-neutral-800",disabled:"cursor-not-allowed border-neutral-200 bg-neutral-200 text-neutral-800 focus:border-neutral-200",readOnly:"cursor-default border-neutral-200 bg-neutral-200 text-gray-600 focus:border-neutral-200 active:border-neutral-800",error:"border-red-500 bg-white text-gray-600 focus:border-red-500 active:border-red-500",valid:"border-green-500 bg-white text-gray-600 focus:border-green-500 active:border-green-500"});return{textAreaClassName:(0,l.p)("flex w-full resize-none rounded-sm border px-3 py-[10px] text-14 focus:outline-none focus:ring-0",a(e),{"overflow-hidden":r})}};var u=a(37897);let c=({value:e,defaultValue:r,onChange:a,label:p="",disabled:c=!1,readOnly:m=!1,valid:v=!1,error:x="",required:h=!1,showOptionalLabel:y=!1,requiredStyle:g="asterisk",className:b="",fitContent:f=!1,...j})=>{let[w,A]=(0,o.A)(e,r),k=(0,s.useRef)(null),{textAreaClassName:N}=d(i({disabled:c,readOnly:m,valid:v,error:x}),{fitContent:f}),F=(0,s.useCallback)(()=>{f&&k.current&&(k.current.style.height=`${k.current.scrollHeight}px`)},[f]),{ref:R}=(0,n.A)(F),C=(0,s.useCallback)(e=>{F(),A(e.target.value),a?.(e)},[a,A,F]);return(0,t.jsxs)("div",{children:[(0,t.jsx)(u.A,{required:h,showOptionalLabel:y,requiredStyle:g,children:p}),(0,t.jsx)("textarea",{ref:e=>{k.current=e,R.current=e},className:(0,l.p)(N,b),value:w,readOnly:m,disabled:c,required:h,onChange:C,...j}),x&&(0,t.jsx)("span",{className:"mt-3 block text-12 font-medium text-red-500",children:x})]})}},34285:(e,r,a)=>{a.d(r,{A:()=>o});var t=a(45512),s=a(58009),l=a.n(s);let o=({group:e,label:r,criteria:a,renderRule:o})=>{let n=(0,s.useCallback)((e,r)=>{if("rule"===e.type){let a=r.find(r=>r.key===e.key),s=e.key,l=a?.name??s,n=a?.operators?.find(r=>r.value===e.operator)?.name??e.operator,i=a?.values?.find(r=>r.value===e.value)?.name??e.value;return o?o({key:s,name:l,opName:n,valName:i}):(0,t.jsxs)("span",{className:"border border-gray-300 px-2 py-1 text-gray-600",children:[l," ",n," ",i]})}let a=[];for(let s=0;s<e.rules.length;++s){let l="group"===e.rules[s].type&&e.rules[s].rules.length>1&&e.rules[s].combinator!==e.combinator;l&&a.push((0,t.jsx)("span",{className:"text-gray-600",children:"("})),a.push((0,t.jsx)("div",{className:"inline-flex flex-wrap items-center gap-3",children:n(e.rules[s],r)})),l&&a.push((0,t.jsx)("span",{className:"text-gray-600",children:")"})),s<e.rules.length-1&&a.push((0,t.jsx)("span",{children:e.combinator.toLowerCase()}))}return l().Children.toArray(a)},[o]);return(0,t.jsxs)("div",{className:"flex items-start gap-5",children:[r&&(0,t.jsx)("div",{className:"rounded-lg bg-neutral-200 px-6 py-1 font-medium text-gray-700",children:r}),(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-3",children:n(e,a)})]})}},29653:(e,r,a)=>{a.d(r,{A:()=>o});var t=a(45512);a(58009);var s=a(94796),l=a(80034);let o=({status:e})=>{let{translate:r}=(0,l.A)();return(0,t.jsx)(s.A,{className:"capitalize",variant:{accepted:"success",rejected:"danger",pending:"warning"}[e],children:r(`dashboard.approval.flow.status.${e}`)})}},74071:(e,r,a)=>{a.d(r,{A:()=>n});var t=a(58009),s=a(77524),l=a(35032),o=a(19217);let n=({businessUnitKey:e,filters:{searchQuery:r,status:a,cursor:n}={}})=>{let{data:i,...p}=(0,s.Ay)(e?["/action/business-unit/queryApprovalFlows",e,r,a]:null,()=>o.x.composableCommerce.businessUnit.queryApprovalFlows({businessUnitKey:e,approvalFlowIds:[...r?[r]:[]],approvalFlowStatus:[...a?[a]:[]],cursor:n,sortAttributes:[{createdAt:"desc"}]})),d=!e||p.isLoading,{mutate:u}=(0,l.iX)(),c=(0,t.useCallback)(()=>{u(e=>"object"==typeof e&&e?.[0].startsWith("/action/business-unit/queryApprovalFlows"),void 0,{revalidate:!0})},[u]),m=i?.isError?[]:i?.data?.items??[],v=i?.isError?0:i?.data.total??0,[x,h]=i?.isError?[void 0,void 0]:[i?.data.previousCursor,i?.data.nextCursor];return{approvalFlows:m,isLoading:d,totalItems:v,previousCursor:x,nextCursor:h,approveApprovalFlow:(0,t.useCallback)(async r=>{if(!e)return;let a=await o.x.composableCommerce.businessUnit.approveApprovalFlow({approvalFlowId:r},{approvalFlowId:r});return!a?.isError&&a.data.approvalFlowId&&c(),a.isError?null:a.data},[e,c]),rejectApprovalFlow:(0,t.useCallback)(async(r,a)=>{if(!e)return;let t=await o.x.composableCommerce.businessUnit.rejectApprovalFlow({approvalFlowId:r,reason:a??""},{approvalFlowId:r,reason:a??""});return!t?.isError&&t.data.approvalFlowId&&c(),t.isError?null:t.data},[e,c]),mutateAll:c}}},32950:(e,r,a)=>{a.d(r,{A:()=>o});var t=a(58009),s=a(19217),l=a(77524);let o=()=>{let e=(0,t.useCallback)(()=>s.x.composableCommerce.businessUnit.getAssociateRoles(),[]),r=(0,l.Ay)("/action/buinsess-unit/getAssociateRoles",e);return{...r,data:r.data?.isError?[]:r.data?.data??[]}}},15872:(e,r,a)=>{a.r(r),a.d(r,{default:()=>I});var t=a(45512),s=a(58009),l=a(62621),o=a(1916),n=a(25306),i=a(80034),p=a(28165),d=a(34285),u=a(85762),c=a(2812),m=a(688),v=a(3486),x=a(27034),h=a(76901),y=a(29653),g=a(93001),b=a(79667);let f=({approvalFlow:e,userRoles:r,viewOnly:a,approversCriteria:l=[],onApprove:o,onReject:f})=>{let{translate:j}=(0,i.A)(),[w,A]=(0,s.useState)(!1),[k,N]=(0,s.useState)(!1),[F,R]=(0,s.useState)(""),C=(0,s.useCallback)((e,r)=>"rule"===r.type?e.key===r.key:r.rules.some(r=>C(e,r)),[]),$=(0,s.useMemo)(()=>{if(!e.rules)return[];let r=e.rules.reduce((e,r)=>Math.max(e,r.approvers?.length??0),0),a=[];for(let t=0;t<r;++t)for(let r of(a.push({type:"group",combinator:"AND",rules:[]}),e.rules))r.approvers?.length&&t<r.approvers.length&&a.at(-1).rules.push(r.approvers[t]);return a},[e.rules]),I=$.findIndex(r=>(e.currentPendingApproverTiers??[]).some(e=>C(e,r)))===$.findIndex(a=>r.filter(r=>!e.approvals.some(e=>!!e.approver.roles.find(e=>e.key===r.key))).some(r=>C(r,a)&&(e.eligibleApprovers??[]).some(e=>e.key===r.key))),S=r.every(r=>e.approvals.some(e=>!!e.approver.roles.find(e=>e.key===r.key))),q=(0,s.useCallback)(async()=>{A(!0),await f?.(F),N(!1),A(!1),x.A.success(j("dashboard.approval.flow.rejected"),{position:"top-right"})},[f,F,j]);return(0,t.jsxs)("div",{children:[a&&(0,t.jsxs)(n.A,{className:"mt-3",children:[(0,t.jsx)("b",{children:j("common.view.only")})," ",j("dashboard.flow.view.only.desc")]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h1",{className:"py-6 text-18 font-extrabold text-gray-800 md:py-7 md:text-20 lg:py-9 lg:text-24",children:j("dashboard.flow.details")}),(0,t.jsx)("div",{className:"hidden items-center justify-normal gap-x-3 md:flex",children:(0,t.jsx)(h.A,{})})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,t.jsxs)("h3",{className:"text-14 text-gray-600",children:[j("dashboard.flow.id"),": ",e.id]}),(0,t.jsxs)("h3",{className:"flex items-center gap-2 text-14 text-gray-600",children:[(0,t.jsxs)("span",{children:[j("common.status"),":"]}),(0,t.jsx)(y.A,{status:e.status})]})]}),(0,t.jsxs)("div",{className:"mt-9 border-t border-neutral-400 pt-10",children:[(0,t.jsx)("h5",{className:"pb-9 text-20 font-bold text-gray-700",children:j("common.approval.flow")}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h6",{className:"text-16 font-semibold text-gray-700",children:j("dashboard.rules.applied")}),(0,t.jsx)("div",{className:"mt-4 flex flex-wrap items-center gap-4 rounded-md border border-gray-300 p-6",children:(e.rules??[]).map((e,r,a)=>(0,t.jsxs)("div",{children:[(0,t.jsx)(p.default,{href:`${g.s.approvalRules}?subPath=edit-approval-rule&id=${e.id}`,className:"text-16 text-blue-700 underline",children:e.name})," ",r<a.length-1&&(0,t.jsx)("span",{children:","})]},e.id))})]})]}),(0,t.jsxs)("div",{className:"mt-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h5",{className:"text-16 font-semibold text-gray-700",children:j("dashboard.approval.flow.required.approvers")}),(0,t.jsx)("div",{className:"mt-1 text-16 font-normal text-gray-700",dangerouslySetInnerHTML:{__html:j("dashboard.approval.flow.required.approvers.desc",{values:{preview:`<div class="w-fit border border-blue-500 p-1 inline-flex items-center gap-1 rounded-sm text-xs text-blue-500">
                    <span>${j("common.name")}</span>
                    <span class="w-[12px] h-[12px] border border-gray-500 rounded-full block" />
                  </div>`}})}})]}),(0,t.jsx)("div",{className:"mt-4 rounded-md border border-gray-300 px-7",children:$.map((a,s,o)=>(0,t.jsxs)("div",{className:(0,u.p)("py-6",{"border-b border-neutral-400":s<o.length-1}),children:[(0,t.jsxs)("div",{className:"flex items-start gap-5",children:[(0,t.jsx)("div",{className:"shrink-0 rounded-full bg-neutral-200 px-6 py-1 text-16 font-medium text-gray-700",children:`${j("dashboard.tier")} ${s+1}`}),(0,t.jsx)(d.A,{group:a,criteria:l,renderRule:({key:a,name:s})=>{let l=r.some(e=>e.key===a),o=e.approvals.some(e=>!!e.approver.roles.find(e=>e.key===a));return(0,t.jsxs)("div",{className:(0,u.p)("flex w-fit items-center gap-2 rounded-sm border px-2 py-1",{"border-gray-300":!l,"border-blue-500":l}),children:[(0,t.jsx)("span",{className:(0,u.p)({"text-gray-600":!l,"text-blue-500":l}),children:s}),(0,t.jsx)("span",{className:(0,u.p)("flex size-[20px] items-center justify-center rounded-full border-2 p-[3px]",{"border-green-600":o,"border-gray-300":!o}),children:o&&(0,t.jsx)(c.A,{className:"stroke-[5px] text-green-600"})})]})}})]}),(0,t.jsx)("div",{className:"flex flex-wrap items-center pt-6",children:(e.rules??[]).map((e,r,a)=>(0,t.jsxs)("div",{className:"whitespace-pre text-gray-500",children:[e.name," ",r<a.length-1&&(0,t.jsxs)("span",{children:[",","  "]})]},e.id))})]},s))}),(0,t.jsx)("div",{className:"mt-7 flex gap-3",children:k?(0,t.jsxs)("form",{className:"w-full",onSubmit:async e=>{e.preventDefault(),q()},children:[(0,t.jsx)("h6",{className:"mb-3 text-12 font-medium uppercase text-gray-600",children:j("dashboard.approval.flow.rejection.reason")}),(0,t.jsx)(v.A,{value:F,className:"h-[150px] w-full md:h-[65px]",fitContent:!1,error:F.length>160?j("dashboard.message.too.long",{values:{maxCharacters:"160"}}):"",onChange:e=>R(e.target.value)}),(0,t.jsxs)("div",{className:"mt-6 flex gap-3",children:[(0,t.jsx)(m.default,{variant:"secondary",size:"l",onClick:()=>N(!1),children:j("common.cancel")}),(0,t.jsx)(m.default,{type:"submit",size:"l",variant:"primary",loading:w,children:j("common.reject")})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.default,{variant:"secondary",size:"l",className:"leading-[16px]",disabled:a||S||!I||"pending"!==e.status,onClick:()=>{N(!0)},children:j("common.reject")}),(0,t.jsx)(m.default,{variant:"primary",size:"l",className:"py-[12px] leading-[16px]",loading:w,disabled:a||S||!I||"pending"!==e.status,onClick:async()=>{A(!0),await o?.(),A(!1)},children:j("common.approve")})]})})]}),(0,t.jsx)("div",{className:"mt-10 border-t border-neutral-400",children:(0,t.jsx)(b.A,{order:e.order,showCtaButtons:!1,showOrderStatusBar:!1})})]})};var j=a(65593),w=a(6505),A=a(17756),k=a(62999),N=a(74071),F=a(33211),R=a(42117),C=a(86630),$=a(32950);let I=({data:e})=>{let r=(0,k.A)(),a=e.data?.dataSource,{projectSettings:s}=(0,F.A)(),n=(0,C.M)({countries:(s?.countries??[]).map(R.D)}),{selectedBusinessUnit:i}=(0,j.rW)(),{permissions:p}=(0,w.A)(i?.key),{account:d}=(0,o.A)(),{roles:u}=(0,w.A)(),{data:c}=(0,$.A)(),{approveApprovalFlow:m,rejectApprovalFlow:v}=(0,N.A)({businessUnitKey:i?.key});return a?(0,t.jsx)(l.A,{userName:d?.firstName,children:(0,t.jsx)(f,{approvalFlow:(0,A.K1)(a,n),userRoles:u.map(e=>({key:e.key,name:e.name})),viewOnly:!p.UpdateApprovalFlows,approversCriteria:c.map(({key:e,name:r})=>({key:e,name:r??e,type:"text",operators:[],values:[]})),onApprove:async()=>{let e=await m(a.approvalFlowId);return e?.approvalFlowId&&r.refresh(),!!e?.approvalFlowId},onReject:async e=>{let t=await v(a.approvalFlowId,e);return t?.approvalFlowId&&r.refresh(),!!t?.approvalFlowId}})}):(0,t.jsx)(t.Fragment,{})}},86630:(e,r,a)=>{a.d(r,{M:()=>t});let t=({countries:e})=>({"totalPrice.centAmount":{type:"text",name:"cart.cart.amount",operators:[{name:"common.is.equal",value:"="},{name:"common.is.more.than",value:">"},{name:"common.is.more.than.or.equal",value:">="},{name:"common.is.less.than",value:"<"},{name:"common.is.less.than.or.equal",value:"<="}],constructPredicateFromRule:e=>`${e.key} ${e.operator} ${100*parseInt(e.value)}`,constructRuleFromPredicate(e){let[r,a,t]=e.split(" ");return{key:r,operator:a,value:Math.floor(parseInt(t)/100).toString()}}},currency:{type:"enum",name:"common.currency",operators:[{name:"common.is",value:"is"},{name:"common.is.not",value:"is_not"}],values:[{name:"USD",value:"USD"},{name:"EUR",value:"EUR"}],constructPredicateFromRule:e=>`${e.key} ${"is"===e.operator?"=":"!="} "${e.value}"`,constructRuleFromPredicate(e){let[r,a,t]=e.split(" ");return{key:r,operator:"="===a?"is":"is_not",value:t}}},country:{type:"enum",name:"common.country",operators:[{name:"common.is",value:"is"},{name:"common.is.not",value:"is_not"}],values:e.map(({name:e,code:r})=>({name:e,value:r})),constructPredicateFromRule:e=>`${e.key} ${"is"===e.operator?"=":"!="} "${e.value}"`,constructRuleFromPredicate(e){let[r,a,t]=e.split(" ");return{key:r,operator:"="===a?"is":"is_not",value:t}}}})},17756:(e,r,a)=>{a.d(r,{K1:()=>n,q_:()=>l});var t=a(34878),s=a(67726);let l=e=>{switch(e){case"accepted":return"Approved";case"rejected":return"Rejected";default:return"Pending"}},o=e=>{switch(e){case"Approved":return"accepted";case"Rejected":return"rejected";default:return"pending"}},n=(e,r)=>({id:e.approvalFlowId,date:e.order.createdAt?new Date(e.order.createdAt).toISOString():"",status:o(e.approvalFlowStatus??"Pending"),businessUnit:{key:e.businessUnitKey},rules:e.approvalRules.map(e=>(0,t.Ah)(e,r))??[],order:(0,s.x)(e.order),approvals:(e.approvalFlowApprovals??[]).map(e=>({approvedAt:e.approvedAt?new Date(e.approvedAt).toISOString():"",approver:{key:e.approver.accountId,name:`${e.approver.firstName??""} ${e.approver.lastName??""}`.trim(),roles:(e.approver.roles??[]).map(({key:e,name:r})=>({key:e??"",name:r??""}))}})),rejection:{rejectedAt:e.approvalFlowRejection?.rejectedAt?new Date(e.approvalFlowRejection?.rejectedAt).toISOString():"",reason:e.approvalFlowRejection?.reason??"",rejecter:{key:e.approvalFlowRejection?.rejecter.accountId,name:`${e.approvalFlowRejection?.rejecter.firstName??""} ${e.approvalFlowRejection?.rejecter.lastName??""}`.trim(),roles:(e.approvalFlowRejection?.rejecter.roles??[]).map(({key:e,name:r})=>({key:e??"",name:r??""}))}},eligibleApprovers:e.eligibleApprovers.map(e=>({key:e.key??"",name:e.name})),pendingApprovers:e.pendingApprovers.map(e=>({key:e.key??"",name:e.name})),currentPendingApproverTiers:e.currentTierPendingApprovers.map(e=>({key:e.key??"",name:e.name}))})},34878:(e,r,a)=>{a.d(r,{Ah:()=>i,GO:()=>l});let t=e=>{if(!e)return[];let r=e=>"rule"===e.type?{or:[{key:e.key}]}:{or:e.rules.filter(e=>"rule"===e.type).map(e=>({key:e.key}))};return e.map(e=>e.rules.map(r)).map(e=>({and:e}))},s=(e,r)=>{if(!e)return"";let a=e=>{if("rule"===e.type)return r[e.key].constructPredicateFromRule(e);let t=[];for(let r=0;r<e.rules.length;++r){let s="group"===e.rules[r].type&&e.rules[r].rules.length>1&&e.rules[r].combinator!==e.combinator;s&&t.push("("),t.push(a(e.rules[r])),s&&t.push(")"),r<e.rules.length-1&&t.push(e.combinator.toLowerCase())}return t.join(" ")};return a(e[0])},l=(e,r)=>({name:e.name,description:e.description,requesters:e.requesters,approvalRuleStatus:"active"===e.status?"Active":"Inactive",approvers:{tiers:t(e.approvers)},predicate:s(e.rules,r)}),o=(e,r)=>{let a=e=>{let t=[],s=e.split(" "),l="AND",o=[],n=()=>{let[e,a,s]=[o.pop(),o.pop(),o.pop()];t.push({type:"rule",...r[s].constructRuleFromPredicate(`${s} ${a} ${e.replace(/\"/g,"")}`)})},i=0;for(;i<s.length;){let e=i+1;if("("===s[i]){let r=[],l=0;for(;")"!==s[e]||l>0;)"("===s[e]?++l:")"===s[e]&&--l,r.push(s[e++]);++e,t.push(a(r.join(" ")))}else"and"===s[i]||"or"===s[i]?(l="and"===s[i]?"AND":"OR",n()):o.push(s[i]);i=e}return o.length>0&&n(),{type:"group",combinator:l,rules:t}};return[a(e)]},n=e=>e.tiers.map(e=>e.and).map(e=>({type:"group",combinator:"AND",rules:e.map(e=>{let r=e=>({type:"rule",isPlaceholder:!1,key:e.key,operator:"",value:""});return 1===e.or.length?r(e.or[0]):{type:"group",combinator:"OR",rules:e.or.map(e=>r(e))}})})),i=(e,r)=>({id:e.approvalRuleId??e.key??"",name:e.name,description:e.description,requesters:e.requesters.map(({key:e,name:r})=>({key:e??"",name:r??e??""})),status:(e.approvalRuleStatus??"Inactive").toLowerCase(),rules:o(e.predicate,r),approvers:n(e.approvers)})}};